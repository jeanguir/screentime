# screentime
Проект ПО, отслеживающего активность ПК. ПО реализует функции, аналогичные Экранному времени на устройствах Apple. Screentime писался для корпоративного клиента, которому нужно следить за работой своих сотрудников.

## Обзор
Проект состоит из трех частей (и все это написано мною с нуля):
1. Веб-панель для администратора
2. Десктопная программа, написанная на Java
3. Серверные PHP скрипты, соединяющие экземпляры Java-программы сотрудников, веб-панель и базу данных


## Java
Java работает в несколько потоков, вот таким образом:
1. Для начала инициализуертся окно для авторизации сотрдуника, затем, после правильной авторизации, программа прячется в трей
2. Логин и id пользователя отправляются HTTP-запросом на PHP скрипты, находящиеся на сервере
3. Там они сверяются с таблицей instructions, где находятся настройки для каждого отдельного сотрудника (там определено, надо ли делать скриншоты экрана, с каким интервалом их делать, отслеживать ли вкладки, отслеживать ли окна и т. п.)
4. Далее, в соответствии с настройками собираются заголовки окон и помещаются в Hash-карту (такой функционал был реализован для того, чтобы после возвращения к старому окну, отсчет времени, проведенного за ним, не начинался по новому), также делаются скриншоты и проверяется, двигает ли пользователь мышью/совершает ли ввод с клавиатуры. Таким образом учитывается только то время в программе и за компьютером, когда пользователь активен.
5. Скриншоты, заголовки окон, вкладок, информация о неактивностях, экранное время вместе с id пользователя собираются в JSON-строку и отправляются HTTP-запросом на PHP скрипты, которые обрабатывают их в базу данных.


## Веб-панель
Здесь просто продемонстрирую все наглядно.

Так админа встречает главная страница:
![Снимок экрана 2024-06-30 в 23 01 05](https://github.com/jeanguir/screentime/assets/89830596/e62277f3-59c2-46c1-85bd-fa0c877db7c8)

После успешной авторизации доступна таблица со всеми сотрудниками:
![Снимок экрана 2024-06-30 в 23 01 23](https://github.com/jeanguir/screentime/assets/89830596/ee9db464-8780-404d-aad7-fc1164073234)

Перейдя на страницу конкретного сотрудника админ видит настройки для этого сотрудника, фильтр данных по дате и 4 таблицы:
![Снимок экрана 2024-06-30 в 23 02 01](https://github.com/jeanguir/screentime/assets/89830596/eb4f0792-706e-4da9-8982-0ed6514651ca)

Регистрация сотрудника также происходит через панель:
![Снимок экрана 2024-06-30 в 23 02 20](https://github.com/jeanguir/screentime/assets/89830596/0ef3eacc-a270-4c39-a0de-d16053c76c1a)


## Базы данных
В phpMyAdmin у меня была база данных со следующими таблицами:
1. daily_activity
id (integer)
user_id (integer)
hours (double)
workday (YYYY-MM-DD)

2. inactivities
id (integer)
start (HH-MM)
end (HH-MM)
duration (float)
date (YYYY-MM-DD)
user_id (integer)

3. instructions
id (integer)
check_interval_in_sec (integer)
inactivity_period_in_min (integer)
make_screenshots (boolean)
track_windows (boolean)
track_tabs (boolean)
user_id (integer)

4. screenshots
id (integer)
user_id (integer)
screenshot_url (string)
created_at (YYYY-MM-DD)
time (HH-MM-SS)

5. tabs
id (integer)
user_id (integer)
tab_name (string)
tab_activity_time (integer)

6. users
id (integer)
username (string)
hashed_passwords (string)
status (string "online"/"offline")

7. windows
id (integer)
user_id (integer)
windows_name (string)
window_activity_time (double)
start (HH:MM)
w_end (HH:MM)
date (YYYY-MM-DD)

